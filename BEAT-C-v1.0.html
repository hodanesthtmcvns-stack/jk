<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>BEAT‑C — Best‑fit Empiric Antibiotic Treatment – Calculator</title>
<style>
  :root{--bg:#0b1220;--card:#121a2b;--ink:#e7eefb;--muted:#9fb3d9;--accent:#5ea0ff;--ok:#2e7d32;--warn:#f9a825;--high:#c62828;--line:#1b2742}
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial;background:var(--bg);color:var(--ink)}
  header{position:sticky;top:0;background:linear-gradient(180deg,rgba(11,18,32,.98),rgba(11,18,32,.9));border-bottom:1px solid var(--line);z-index:5}
  .bar{display:flex;gap:10px;align-items:center;padding:12px 14px}
  .title{font-weight:700}
  .ts{margin-left:auto;color:var(--muted);font-size:12px}
  .wrap{max-width:980px;margin:0 auto;padding:16px 14px 120px}
  .card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:14px;margin-top:14px}
  .row{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:8px 0;border-bottom:1px dashed var(--line)}
  .row:last-child{border-bottom:none}
  select,input,textarea{width:100%;background:#0e1730;border:1px solid var(--line);color:var(--ink);border-radius:10px;padding:8px;font-size:14px}
  .btn{border-radius:12px;padding:8px 10px;background:#0f1a33;color:var(--ink);border:1px solid var(--line);font-weight:600}
  .btn.primary{background:var(--accent);color:#04132b}
  .tbl{width:100%;border-collapse:collapse;font-size:13px}
  .tbl th,.tbl td{border:1px solid var(--line);padding:4px;text-align:center}
  .tbl th{background:#0f1a33}
  .kpi{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:6px}
  .pill{background:#0f1a33;border:1px solid var(--line);padding:6px 8px;border-radius:10px;font-size:13px}
  .good{color:var(--ok)}.warn{color:var(--warn)}.bad{color:var(--high)}
  .hint{font-size:12px;color:var(--muted)}
  .mono{font-family:ui-monospace,Menlo,Consolas,monospace}
</style>
</head>
<body>
<header><div class="bar"><div class="title">BEAT‑C — Best‑fit Empiric Antibiotic Treatment – Calculator, v 1.0, 28Sep2025</div><div class="ts" id="timestamp"></div></div>
<div class="hint" style="padding:6px 14px 0">Default antibiogram: <b>TMC VNS 2024</b> (editable). Reference guide option: <b>Local SOP</b> or <b>SHC Sepsis Guide 2025</b>. Author: <b>Prof. Jyotirmay Kirtania</b>.</div></header>
<div class="wrap">

<section class="card" id="pfCard">
  <h3>1) Patient factors</h3>
  <style>
    /* Aesthetic toggle switches (no engine change) */
    .pf-grid{display:grid;gap:10px}
    @media(min-width:720px){.pf-grid{grid-template-columns:repeat(2,1fr)}}
    .pf-item{display:flex;align-items:center;justify-content:space-between;background:#0f1a33;border:1px solid var(--line);border-radius:12px;padding:10px}
    .pf-label{font-size:14px}
    .switch{position:relative;display:inline-block;width:46px;height:28px}
    .switch input{opacity:0;width:0;height:0}
    .slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background:#122447;border:1px solid var(--line);transition:.25s;border-radius:9999px}
    .slider:before{position:absolute;content:"";height:22px;width:22px;left:2px;top:2px;background:#768bbd;border-radius:50%;transition:.25s}
    .switch input:checked + .slider{background:var(--accent)}
    .switch input:checked + .slider:before{transform:translateX(18px);background:#04132b}
  </style>

  <div class="pf-grid">
    <div class="pf-item"><div class="pf-label">Septic shock</div><label class="switch"><input type="checkbox" id="shock"><span class="slider"></span></label></div>
    <div class="pf-item"><div class="pf-label">Hospital‑onset / ICU‑acquired</div><label class="switch"><input type="checkbox" id="hosp"><span class="slider"></span></label></div>
    <div class="pf-item"><div class="pf-label">Device‑related</div><label class="switch"><input type="checkbox" id="device"><span class="slider"></span></label></div>
    <div class="pf-item"><div class="pf-label">Neutropenia / strong immunosuppression</div><label class="switch"><input type="checkbox" id="neut"><span class="slider"></span></label></div>
    <div class="pf-item"><div class="pf-label">Known ESBL/CRE</div><label class="switch"><input type="checkbox" id="cre"><span class="slider"></span></label></div>
    <div class="pf-item"><div class="pf-label">Known MRSA</div><label class="switch"><input type="checkbox" id="mrsa"><span class="slider"></span></label></div>
    <div class="pf-item"><div class="pf-label">Broad antibiotics &lt;90d</div><label class="switch"><input type="checkbox" id="abx90"><span class="slider"></span></label></div>
    <div class="pf-item"><div class="pf-label">β‑lactam anaphylaxis</div><label class="switch"><input type="checkbox" id="blAllergy"><span class="slider"></span></label></div>
    <div class="pf-item"><div class="pf-label">Renal failure/RRT</div><label class="switch"><input type="checkbox" id="renal"><span class="slider"></span></label></div>
    <div class="pf-item"><div class="pf-label">Pregnancy</div><label class="switch"><input type="checkbox" id="preg"><span class="slider"></span></label></div>
    <div class="pf-item"><div class="pf-label">Myasthenia gravis</div><label class="switch"><input type="checkbox" id="mg"><span class="slider"></span></label></div>
    <div class="pf-item"><div class="pf-label">Prolonged QTc</div><label class="switch"><input type="checkbox" id="qtc"><span class="slider"></span></label></div>
    <div class="pf-item"><div class="pf-label">High fungal risk</div><label class="switch"><input type="checkbox" id="fungalRisk"><span class="slider"></span></label></div>
  </div>

  <div class="row" style="margin-top:10px">
    <div style="flex:1">
      <label class="hint">Suspected source</label>
      <select id="source">
        <option value="unk">Unknown</option>
        <option value="pna">Pneumonia</option>
        <option value="iab">Abdominal/diarrhea</option>
        <option value="uti">Urosepsis</option>
        <option value="clr">Catheter/line</option>
        <option value="cns">CNS/meningitis</option>
        <option value="ssti">Skin/soft tissue</option>
      </select>
    </div>
  </div>

  <details style="margin-top:8px">
    <summary class="hint">Advanced patient details (click to expand)</summary>
    <div style="display:grid;gap:10px;grid-template-columns:repeat(2,1fr);margin-top:8px">
      <div><label class="hint">Age (y)</label><input type="number" id="age" min="0" max="120"></div>
      <div><label class="hint">Weight (kg)</label><input type="number" id="wt" min="1" max="400" step="0.1"></div>
      <div><label class="hint">Sex</label>
        <select id="sex"><option value="male">Male</option><option value="female">Female</option></select>
      </div>
      <div><label class="hint">Serum Creatinine (mg/dL)</label><input type="number" id="scr" min="0" step="0.01"></div>
      <div><label class="hint">ICU days</label><input type="number" id="icuDays" min="0"></div>
      <div><label class="hint">Ventilated</label><label class="switch"><input type="checkbox" id="vent"><span class="slider"></span></label></div>
      <div><label class="hint">Central line</label><label class="switch"><input type="checkbox" id="cline"><span class="slider"></span></label></div>
      <div><label class="hint">TPN</label><label class="switch"><input type="checkbox" id="tpn"><span class="slider"></span></label></div>
    </div>
  </details>
</section>

<section class="card" id="abxCard">
  <h3>2) Compute best‑fit empiric regimen</h3>
  <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center">
    <button class="btn primary" id="compute">Compute</button>
    <button class="btn" id="printBtn">Print / Save PDF</button>
    <div style="margin-left:auto;display:flex;gap:8px;align-items:center">
      <label class="hint">Reference guide</label>
      <select id="refGuide">
        <option value="local" selected>Local SOP (default)</option>
        <option value="shc">SHC Sepsis Guide (2025)</option>
      </select>
    </div>
  </div>
  <div id="result" style="margin-top:10px"></div>
</section>

<details>
  <summary class="hint">Advanced: Edit antibiogram & local policy</summary>
  <section class="card">
    <h3>Antibiogram</h3>
    <p class="hint">Default loaded: <b>TMC VNS 2024</b> summary values. You can edit cells or import your own CSV/JSON. Please verify against your official PDF.</p>
    <table class="tbl" id="abgTbl"></table>
    <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:8px">
      <button class="btn" id="loadDemo">Load TMC VNS 2024 defaults</button>
      <button class="btn" id="clearTbl">Clear</button>
      <input type="file" id="csvFile" accept=".csv" />
      <button class="btn" id="uploadCsv">Upload CSV</button>
      <input type="file" id="jsonFile" accept=".json" />
      <button class="btn" id="uploadJson">Upload JSON</button>
      <button class="btn" id="dlTemplate">Download CSV template</button>
      <button class="btn" id="dlJsonTemplate">Download JSON template</button>
    </div>
  </section>
</details>

</div>

<script>
(function(){
  'use strict';

  // ==== Small utilities & hotfix helpers
  function $(id){ return document.getElementById(id); }
  function safe(fn){ try{ fn(); } catch(e){ console.error(e); showError('Script error: '+(e.message||'unknown')); } }
  function showError(msg){ const res=$('result'); if(res){ res.innerHTML = `<p class="bad">${msg}</p>`; } }

  // Make timestamp tick
  const ts=$('timestamp'); if(ts){ const t=()=>ts.textContent=new Date().toLocaleString(); t(); setInterval(t,60_000); }

  // Renal helpers (global)
  function calcCrCl(age, wt, scr, sex){ if(!age||!wt||!scr||scr<=0) return null; let v=((140-age)*wt)/(72*scr); if((sex||'').toLowerCase()==='female') v*=0.85; return v; }
  function renalBand(crcl){ if(crcl==null||isNaN(crcl)) return 'unknown'; if(crcl>=60) return '≥60 mL/min'; if(crcl>=30) return '30–59 mL/min'; if(crcl>=10) return '10–29 mL/min'; return '<10 mL/min or dialysis'; }

  // Domain
  const agents=[{id:'ctx',name:'Ceftriaxone'},{id:'cfp',name:'Cefepime'},{id:'ptz',name:'Piperacillin/Tazobactam'},{id:'mero',name:'Meropenem'},{id:'ami',name:'Amikacin'},{id:'levo',name:'Levofloxacin'},{id:'vanc',name:'Vancomycin'},{id:'lzd',name:'Linezolid'},{id:'doxy',name:'Doxycycline'},{id:'col',name:'Colistin'},{id:'ech',name:'Echinocandin'},{id:'flu',name:'Fluconazole'}];
  const organisms=[{id:'eco',name:'E. coli',group:'GNB'},{id:'kpn',name:'Klebsiella',group:'GNB'},{id:'psa',name:'Pseudomonas',group:'GNB'},{id:'aba',name:'Acinetobacter',group:'GNB'},{id:'sau',name:'S. aureus (MSSA)',group:'GPC'},{id:'mrsa',name:'MRSA',group:'GPC'},{id:'ent',name:'Enterococcus',group:'GPC'},{id:'cand',name:'Candida spp.',group:'FUN'}];
  const cover={ctx:{GNB:true,GPC:true}, cfp:{GNB:true,GPC:true,psa:true}, ptz:{GNB:true,GPC:true,psa:true}, mero:{GNB:true,GPC:true,psa:true,aba:true}, ami:{GNB:true,psa:true}, levo:{GNB:true,GPC:true}, vanc:{GPC:true,mrsa:true,ent:true}, lzd:{GPC:true,mrsa:true,ent:true}, doxy:{GNB:true,GPC:true}, col:{GNB:true,psa:true,aba:true}, ech:{FUN:true}, flu:{FUN:true} };
  const sourceWeights={unk:{eco:35,kpn:30,psa:15,aba:10,sau:4,mrsa:3,ent:3,cand:5}, pna:{eco:5,kpn:10,psa:25,aba:15,sau:10,mrsa:10,ent:5,cand:3}, iab:{eco:25,kpn:25,psa:10,aba:10,sau:3,mrsa:2,ent:17,cand:8}, uti:{eco:40,kpn:30,psa:10,aba:5,sau:0,mrsa:0,ent:15,cand:0}, clr:{eco:10,kpn:15,psa:20,aba:15,sau:10,mrsa:20,ent:10,cand:10}, cns:{eco:0,kpn:0,psa:0,aba:0,sau:15,mrsa:40,ent:30,cand:0}, ssti:{eco:10,kpn:10,psa:5,aba:5,sau:35,mrsa:20,ent:10,cand:5} };

  // Demo antibiogram (prepopulated)
  // TMC VNS 2024 (summary-derived placeholders; edit as needed)
  const demoPrev={eco:28,kpn:22,psa:15,aba:8,sau:5,mrsa:3,ent:4,cand:5};
  const demoS={
    eco:{ctx:58,cfp:72,ptz:70,mero:92,ami:85,levo:55,col:98},
    kpn:{ctx:40,cfp:65,ptz:62,mero:88,ami:78,levo:45,col:96},
    psa:{cfp:75,ptz:70,mero:85,ami:82,levo:58,col:95},
    aba:{cfp:25,ptz:20,mero:55,ami:35,levo:20,col:85},
    sau:{levo:45,doxy:80},
    mrsa:{vanc:95,lzd:99},
    ent:{vanc:85,lzd:92},
    cand:{ech:93,flu:41}
  };

  // Build antibiogram UI (in Advanced panel)
  const abgTbl=$('abgTbl');
  function buildTable(){ if(!abgTbl) return; let html='<tr><th>Organism</th><th>Prev %</th>'+agents.map(a=>`<th>${a.name}<br><span class="hint">%S</span></th>`).join('')+'</tr>'; organisms.forEach(o=>{ html+=`<tr data-org="${o.id}"><td style="text-align:left">${o.name}</td><td><input class="prev" type="number" min="0" max="100"></td>`+agents.map(a=>`<td><input class="sus" data-agent="${a.id}" type="number" min="0" max="100"></td>`).join('')+'</tr>'; }); abgTbl.innerHTML=html; }
  buildTable();

  // Fill demo data (also used if cells are blank)
  function loadDemo(){ if(!abgTbl) return; organisms.forEach(o=>{ const row=abgTbl.querySelector(`tr[data-org="${o.id}"]`); if(!row) return; const p=row.querySelector('.prev'); if(p) p.value=demoPrev[o.id]||''; agents.forEach(a=>{ const s=row.querySelector(`input.sus[data-agent="${a.id}"]`); if(s) s.value=(demoS[o.id]?.[a.id]||''); }); }); }
  const loadBtn=$('loadDemo'); if(loadBtn) loadBtn.addEventListener('click',()=>safe(loadDemo)); const clrBtn=$('clearTbl'); if(clrBtn) clrBtn.addEventListener('click',()=>{ if(!abgTbl) return; abgTbl.querySelectorAll('input').forEach(i=>i.value=''); });

  // Always load defaults once so Compute has data
  safe(loadDemo);

  // Read antibiogram (uses demo values if inputs are blank)
  function readABG(source){ const weights={...sourceWeights[source]}; const prev={}, S={}; organisms.forEach(o=>{ const row=abgTbl? abgTbl.querySelector(`tr[data-org="${o.id}"]`) : null; let p = row? parseFloat(row.querySelector('.prev')?.value) : NaN; prev[o.id]=Number.isFinite(p)?p:(weights[o.id]||0); S[o.id]={}; agents.forEach(a=>{ let v = row? parseFloat(row.querySelector(`input.sus[data-agent="${a.id}"]`)?.value) : NaN; if(!Number.isFinite(v)) v = (demoS[o.id]?.[a.id]||0); S[o.id][a.id]=v; }); }); const sum=Object.values(prev).reduce((a,b)=>a+b,0)||1; Object.keys(prev).forEach(k=>prev[k]=prev[k]/sum*100); return {prev,S}; }

  // Coverage math
  function regimenCoverage(drugs,abg){ let cov=0; for(const [org,pr] of Object.entries(abg.prev)){ let pNo=1; const g=organisms.find(o=>o.id===org).group; for(const d of drugs){ const ok = cover[d][g] || cover[d][org]; if(!ok) continue; const s=(abg.S[org][d]||0)/100; pNo*=(1-s); } cov+=(pr/100)*(1-pNo); } return cov*100; }

  // Candidate regimens
  const baseRegs=[["ptz"],["ptz","ami"],["cfp","ami"],["mero"],["mero","ami"],["ctx","ami"],["col","mero"]];
  function shortlist(abg,ctx){ const regs=[...baseRegs]; if(ctx.fungalRisk) regs.push(["ech"]); let scored=regs.map(r=>({drugs:r,cov:regimenCoverage(r,abg),pen:0})); // small penalties
    scored.forEach(s=>{ if(s.drugs.includes('col')) s.pen+=4; if(s.drugs.includes('mero')) s.pen+=0; if(ctx.shock) s.pen*=0.5; });
    scored.forEach(s=>s.score=s.cov - s.pen); return scored.sort((a,b)=>b.score-a.score); }

  // Dosing lines (preview only)
  function roundTo(v,step){ return Math.round(v/step)*step; }
  function dosingAdvice(d,ctx){ const wt=ctx.wt||null; const crcl=ctx.crcl; const ext=['ptz','cfp','mero'].includes(d); const L=(x)=>`<div>• ${x}</div>`; switch(d){ case 'ami':{ const mg = wt? roundTo(wt*17.5,25):null; return L(`Amikacin: ${mg? mg+' mg' : '15–20 mg/kg'} IV q24h; TDM & renal adjust.`);} case 'vanc':{ const mg=wt? roundTo(wt*15,250):null; return L(`Vancomycin: ${mg? mg+' mg q12h start' : '15–20 mg/kg q8–12h start'}; AUC‑guided.`);} case 'mero':{ let base='1 g IV q8h'; if(crcl!=null){ if(crcl<50&&crcl>=30) base='1 g q12h'; else if(crcl<30&&crcl>=10) base='1 g q24h'; else if(crcl<10) base='0.5–1 g q24–48h'; } return L(`Meropenem: ${base}${ext?' (prefer 3 h extended infusion)':''}.`);} case 'ptz':{ let base='4.5 g IV q8h'; if(crcl!=null){ if(crcl<40&&crcl>=20) base='3.375–4.5 g q8–12h'; else if(crcl<20) base='2.25–3.375 g q8–12h'; } return L(`Piperacillin/Tazobactam: ${base}${ext?' over 4 h':''}.`);} case 'cfp':{ let base='2 g IV q8–12h'; if(crcl!=null){ if(crcl<50&&crcl>=30) base='2 g q12h'; else if(crcl<30&&crcl>=10) base='1–2 g q24h'; else if(crcl<10) base='1 g q24–48h'; } return L(`Cefepime: ${base}${ext?' (consider extended infusion)':''}.`);} case 'ctx': return L('Ceftriaxone: 1–2 g IV q24h.'); case 'levo':{ let base='750 mg q24h'; if(crcl!=null&&crcl<50) base='750 mg once, then 500 mg q48h'; return L(`Levofloxacin: ${base}.`);} case 'col': return L('Colistin (CMS): 9 MIU load → ~4.5 MIU q12h; renal adjust.'); case 'doxy': return L('Doxycycline: 100 mg IV/PO q12h.'); case 'ech': return L('Echinocandin: caspo 70 mg LD → 50 mg q24h / mica 100 mg q24h.'); case 'flu': return L('Fluconazole: 800 mg LD → 400 mg q24h; reduce if CrCl 21–50.'); default: return ''; } }

  // Compute handler
  function compute(){ const ctx={ shock:$('shock').checked, hosp:$('hosp').checked, device:$('device').checked, neut:$('neut').checked, cre:$('cre').checked, mrsa:$('mrsa').checked, abx90:$('abx90').checked, blAllergy:$('blAllergy').checked, renal:$('renal').checked, preg:$('preg').checked, mg:$('mg').checked, qtc:$('qtc').checked, fungalRisk:$('fungalRisk').checked, age:parseFloat($('age')?.value)||null, wt:parseFloat($('wt')?.value)||null, scr:parseFloat($('scr')?.value)||null, sex:($('sex')?.value||'male'), icuDays:parseFloat($('icuDays')?.value)||0, vent:$('vent')?.checked||false, cline:$('cline')?.checked||false, tpn:$('tpn')?.checked||false };
    const source=$('source').value; const abg=readABG(source);
    // Adjust priors a bit
    if(ctx.hosp||ctx.device||ctx.abx90){ abg.prev.psa+=5; abg.prev.aba+=3; }
    if(ctx.vent){ abg.prev.psa+=3; }
    if(ctx.tpn||ctx.cline){ abg.prev.cand+=3; }
    // Renormalise
    const tot=Object.values(abg.prev).reduce((a,b)=>a+b,0)||1; Object.keys(abg.prev).forEach(k=>abg.prev[k]=abg.prev[k]/tot*100);
    // CrCl
    ctx.crcl = calcCrCl(ctx.age, ctx.wt, ctx.scr, ctx.sex);

    let picks = shortlist(abg,ctx);
    // Guardrails
    const ban=new Set(); const beta=new Set(['ctx','cfp','ptz','mero']); if(ctx.blAllergy) beta.forEach(b=>ban.add(b)); if(ctx.preg) ['levo','doxy','ami','col'].forEach(x=>ban.add(x)); if(ctx.mg) ['ami','levo'].forEach(x=>ban.add(x)); if(ctx.qtc) ['levo'].forEach(x=>ban.add(x)); if(ctx.renal) ['ami','col'].forEach(x=>ban.add(x)); picks=picks.filter(r=>!r.drugs.some(d=>ban.has(d)));

    if(picks.length===0){ $('result').innerHTML = '<p class="warn">No suitable regimen after guardrails.</p>'; return; }

    const top=picks.slice(0,3);
    const cards = top.map((r,i)=>{ const cls=i===0?'good':(i===1?'warn':''); const label=r.drugs.map(d=>agents.find(a=>a.id===d)?.name||d).join(' + '); const doseLines=r.drugs.map(d=>dosingAdvice(d,ctx)).join(''); const crtxt = (ctx.crcl!=null)? `Estimated CrCl (CG): <b>${ctx.crcl.toFixed(0)}</b> mL/min • ${renalBand(ctx.crcl)}` : 'Estimated CrCl: <i>enter age, weight, SCr</i>'; return `<div class="card"><div class="kpi"><div class="pill ${cls}"><b>Option ${i+1}</b></div><div class="pill">Coverage <b class="${cls}">${r.cov.toFixed(0)}%</b></div></div><h3 style="margin-top:6px">${label}</h3><details class="hint" style="margin-top:6px"><summary>Show dosing (weight & renal‑aware)</summary><div class="hint">${crtxt}${doseLines? '<br>'+doseLines : ''}</div></details><p class="hint">Context: ${[ctx.shock?'shock':null,ctx.hosp?'hospital‑onset':null,ctx.device?'device':null,ctx.neut?'neutropenia':null,ctx.abx90?'recent ABx':null,ctx.blAllergy?'β‑lactam allergy':null,ctx.renal?'renal failure':null,ctx.preg?'pregnancy':null,ctx.mg?'myasthenia':null,ctx.qtc?'QTc':null,ctx.vent?'ventilated':null,ctx.cline?'central line':null,ctx.tpn?'TPN':null,ctx.fungalRisk?'fungal risk':null].filter(Boolean).join(', ')||'none'}</p></div>`; }).join('');

    const parallel = `<div class="card"><h3>Parallel tasks (first hour to first six hours bundle)</h3><ul class="hint"><ol><li>Send cultures before first dose if feasible: blood ×2, sputum/ETA/NDBAL, urine, pus/drain.</li><li>Source control within 6–12 h (drain/debride, remove/exchange infected lines & tubes).</li><li>Hemodynamics: PLR and POCUS-guided balanced crystalloids (RL); noradrenaline infusion to MAP ≥65 mmHg; hydrocortisone 4 mg/kg IV bolus and 4 mg/kg IVI over 24 h for 3 days.</li><li>Oxygenation target: PaO2 70 - 90 mmHg, SpO₂ 92–96%; avoid hyperoxia (avoid PaO2 > 120 mmHg for prolonged periods). </li><li>Intubate and Ventilate if, GCS≤8 or inability to protect airway, or, Refractory Hypoxemia (PaO2​/FiO2​<200 or SpO2​<90% on  FiO2​>50% on >30 LPM flow on HFNC), or, Hypercapnic Respiratory Failure (PaCO2​≥50 mmHg with pH<7.30), or, Signs of Impending Exhaustion (RR>33 bpm, tracheal tug, sweating, agitation, paradoxical breathing).</li><li>Monitoring: mental status, capillary refill time, ABG, lactate trend, MAP, urine output, tympanic and peripheral temperature, 6am blood glucose, serum NT-proBNP, serum creatinine, INR; daily de-escalation review (24–48–72 h).</li><li>Glycemia 140–180 mg/dL.</li><li>Stress-ulcer prophylaxis - pantoprazole 40 mg IV/PO once daily.</li><li>VTE prophylaxis, Enoxaparin 20 - 40 mg SC once daily (withhold if platelets < 80,000/micro L, or INR > 1.4).</li><li>Early enteral nutrition, calorie dense diet / NGT formula feed (2 - 3 scoops/100mL), plus MCT oil 20 mL twice daily.</li><li>Severe anemia correction, target Hb 8 - 10 g/dL; followup action, ferric carboxymaltose 0.5 - 1 g IVI over 30 min, syrup multivitamin 15 mL once daily.</li></li><li>Communicate with the family - present physical status, prognosis, ongoing treatment, short term treatment plan.</li></ol></ul></div>`;

    $('result').innerHTML = cards + parallel;
  }

  // Bind buttons once DOM is ready
  document.addEventListener('DOMContentLoaded',()=>{
    $('printBtn')?.addEventListener('click',()=>window.print());
    $('compute')?.addEventListener('click',()=>safe(compute));
  });

})();
</script>
</body>
</html>
